# WebDAV连接测试说明

## 测试脚本功能

这个测试脚本用于验证WebDAV连接和基本文件操作功能，主要包括：

1. **连接测试**：验证能否成功连接到坚果云WebDAV服务器
2. **目录操作**：创建、列出、删除目录
3. **文件操作**：上传、下载、获取文件信息、删除文件
4. **错误处理**：提供详细的错误信息和解决建议

## 使用前准备

### 1. 获取坚果云应用密码

1. 登录坚果云官网 (https://www.jianguoyun.com/)
2. 点击右上角账户名，选择【账户信息】→【安全选项】
3. 在"第三方应用管理"中，选择"添加应用密码"
4. 输入应用名称（如：fastReader），生成密码
5. **重要**：使用生成的应用密码，不是你的登录密码

### 2. 配置测试脚本

编辑 `webdav-connection-test.mjs` 文件，填入你的坚果云信息：

```javascript
const JIANGUOYUN_CONFIG = {
  url: 'https://dav.jianguoyun.com/dav/',
  username: 'your-email@example.com', // 填入你的坚果云账户邮箱
  password: 'your-app-password'       // 填入生成的应用密码
};
```

## 运行测试

在项目根目录下运行：

```bash
node test/webdav-connection-test.mjs
```

## 预期输出

### 成功连接的输出示例：
```
=== WebDAV连接和功能测试 ===

开始测试WebDAV连接...
服务器地址: https://dav.jianguoyun.com/dav/
正在获取根目录内容...
✅ 连接成功！
根目录包含 X 个项目:
  1. 我的文件夹 (directory) - 0 bytes
  2. 文件.txt (file) - 1024 bytes

开始测试文件操作...
创建测试目录: /fastReader-test
✅ 测试目录创建成功
上传测试文件: /fastReader-test/test-file.txt
✅ 文件上传成功
获取文件信息...
✅ 文件信息: test-file.txt, 大小: 85 bytes
下载文件内容...
✅ 文件下载成功
文件内容:
这是一个测试文件
创建时间: 2025-10-31T13:48:00.000Z
WebDAV测试

列出测试目录内容...
✅ 测试目录包含 1 个项目:
  1. test-file.txt (file)
清理测试文件...
✅ 测试文件删除成功
✅ 测试目录删除成功

🎉 所有文件操作测试通过！
```

### 连接失败的输出示例：
```
❌ 连接失败:
错误类型: HTTPError
错误信息: Request failed with status code 401

💡 连接失败可能的原因:
1. 用户名或密码错误
2. 应用密码未正确生成（需要在坚果云安全选项中生成）
3. 网络连接问题
4. 坚果云WebDAV服务暂时不可用
```

## 故障排除

### 常见问题

1. **401 Unauthorized错误**
   - 检查邮箱是否正确
   - 确认使用的是应用密码，不是登录密码
   - 重新生成应用密码

2. **网络连接问题**
   - 检查网络连接
   - 确认防火墙没有阻止HTTPS连接
   - 尝试使用其他网络环境

3. **访问频率限制**
   - 坚果云免费版每30分钟限制600次请求
   - 如果触发限制，请等待一段时间后重试

### 测试注意事项

- 测试脚本会在WebDAV根目录创建临时目录和文件
- 测试完成后会自动清理所有创建的文件和目录
- 不会影响你现有的文件

## 下一步

测试通过后，可以继续进行：
1. 集成WebDAV功能到主程序
2. 实现文件浏览器界面
3. 添加自动同步功能
4. 优化性能和错误处理
