# 配置导出导入功能文档

## 功能概述

实现了完整的系统设置导出和导入功能，支持将所有应用配置导出为YAML格式文件，并能够从YAML文件恢复配置。此功能包括AI配置、提示词配置、WebDAV配置、处理选项等所有设置项。

## 功能特性

### 导出功能
- **完整导出**：导出所有系统配置，包括：
  - AI服务商配置（多个提供商、API密钥、模型设置等）
  - 提示词配置（V1和V2版本的完整提示词）
  - WebDAV配置（服务器设置、同步选项等）
  - 处理选项（书籍类型、语言、章节检测等）
  - Token使用量统计
- **YAML格式**：使用标准YAML格式，便于阅读和编辑
- **版本管理**：包含配置文件版本和导出时间戳
- **自动下载**：导出后自动下载为本地文件

### 导入功能
- **文件上传**：支持选择本地YAML配置文件
- **文本粘贴**：支持直接粘贴YAML内容
- **配置验证**：导入前验证配置完整性和版本兼容性
- **错误处理**：详细的错误提示和失败原因
- **完整覆盖**：导入后完全替换当前配置

### 安全特性
- **备份提醒**：建议用户在导入前备份当前配置
- **确认机制**：重置功能需要用户确认
- **敏感信息处理**：完整导出所有配置（包括API密钥等敏感信息）

## 技术实现

### 核心服务：ConfigExportService

位置：`src/services/configExportService.ts`

#### 主要方法

```typescript
// 导出配置为YAML格式
static exportConfig(config: ConfigState): string

// 从YAML导入配置
static importConfig(yamlContent: string): FullConfigExport

// 验证配置完整性
static validateConfig(config: FullConfigExport): { isValid: boolean; errors: string[] }

// 生成配置文件名
static generateFileName(): string

// 创建配置备份
static createBackup(config: ConfigState): FullConfigExport
```

#### 数据过滤

导出时自动过滤函数类型的属性，只序列化配置数据：
- AI配置管理器中的方法函数会被过滤
- 只保留配置数据和状态信息

### Store集成

在`configStore.ts`中添加了导出导入相关方法：

```typescript
// 导出当前配置
exportConfig: () => string

// 导入配置并应用
importConfig: (yamlContent: string) => { success: boolean; error?: string }

// 重置所有配置
resetAllConfig: () => void
```

### UI组件

位置：`src/components/ConfigExportImport.tsx`

#### 功能区域

1. **导出配置**：一键导出所有设置为YAML文件
2. **导入配置**：
   - 文件选择器上传配置文件
   - 文本框粘贴YAML内容
   - 导入结果显示
3. **重置配置**：恢复所有设置为默认值
4. **使用说明**：功能介绍和注意事项

#### 交互特性

- 加载状态指示
- 成功/失败消息提示
- 实时错误反馈
- 清空和重置功能

## 集成位置

功能已集成到主设置界面中：
- 位置：`ConfigDialog.tsx`
- 标签页：**导出导入**
- 访问路径：主界面 → 设置按钮 → 导出导入标签

## 配置文件格式

### YAML结构示例

```yaml
version: "1.0.0"
exportTime: "2024-01-01T12:00:00.000Z"
config:
  aiConfigManager:
    providers:
      - id: "provider-123"
        name: "Google Gemini"
        provider: "gemini"
        apiKey: "your-api-key"
        apiUrl: "https://generativelanguage.googleapis.com/v1beta"
        model: "gemini-1.5-flash"
        temperature: 0.7
        # ... 其他配置
    activeProviderId: "provider-123"
  processingOptions:
    processingMode: "mindmap"
    bookType: "non-fiction"
    outputLanguage: "zh"
    # ... 其他选项
  webdavConfig:
    enabled: true
    serverUrl: "https://dav.jianguoyun.com/dav/"
    # ... WebDAV设置
  promptConfig:
    chapterSummary:
      fiction: "小说章节总结提示词"
      nonFiction: "非小说章节总结提示词"
    # ... 提示词配置
  promptVersionConfig:
    v1: { /* V1版本提示词 */ }
    v2: { /* V2版本提示词 */ }
  currentPromptVersion: "v2"
  tokenUsage: 1500
```

### 版本兼容性

- 当前版本：1.0.0
- 版本检查：导入时验证版本兼容性
- 向后兼容：支持从旧版本升级（未来实现）

## 测试覆盖

### 单元测试
- `configExportImport.test.ts`：基础导出导入功能测试
- `configValidation.test.ts`：配置验证功能测试
- `integration.test.ts`：完整集成测试

### 测试场景
- ✅ 正常导出导入流程
- ✅ YAML格式验证
- ✅ 配置完整性检查
- ✅ 版本兼容性验证
- ✅ 错误处理机制
- ✅ 文件名生成
- ✅ 配置备份创建

## 使用场景

### 配置备份
- 定期导出配置作为备份
- 在系统重装或迁移前保存配置

### 设备同步
- 在不同设备间同步配置
- 团队成员间共享标准配置

### 配置管理
- 批量配置多台设备
- 版本控制和回滚
- 测试不同配置组合

### 故障恢复
- 配置错误时快速恢复
- 重置为默认配置

## 注意事项

### 安全提醒
- 配置文件包含API密钥等敏感信息
- 请妥善保管导出的配置文件
- 不要在不安全的环境中分享配置文件

### 使用建议
- 导入前建议先导出当前配置作为备份
- 确认配置文件来源可靠
- 导入后检查各项设置是否正确

### 兼容性
- 当前仅支持1.0.0版本配置文件
- 未来版本会保持向后兼容
- 重大版本变更时会提供迁移工具

## 未来扩展

### 计划功能
- [ ] 配置文件加密
- [ ] 增量导入（部分配置更新）
- [ ] 配置模板功能
- [ ] 自动备份计划
- [ ] 云端配置同步

### 版本演进
- v1.1.0：支持配置文件加密
- v1.2.0：增量导入和模板功能
- v2.0.0：云端同步和自动备份

## 相关文件

- `src/services/configExportService.ts`：核心导出导入服务
- `src/components/ConfigExportImport.tsx`：UI组件
- `src/stores/configStore.ts`：Store集成
- `test/configExportImport.test.ts`：基础测试
- `test/integration.test.ts`：集成测试
- `test/configValidation.test.ts`：验证测试
